<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description"
        content="Chess Tricks: El mejor lugar para jugar ajedrez online, resolver puzzles y aprender con el Maestro IA.">

    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="Chess Tricks | Maestro IA & Puzzles">
    <meta property="og:description" content="Domina el tablero con el Maestro IA y resuelve miles de puzzles t√°cticos.">
    <meta property="og:image" content="logo.jpg">
    <meta property="og:type" content="website">

    <title>Chess Tricks | Maestro IA & Puzzles</title>

    <!-- Fallback Logic for Scripts -->
    <script>
        function loadFallback(src) {
            var script = document.createElement('script');
            script.src = src;
            document.head.appendChild(script);
        }
    </script>

    <!-- LIBRER√çAS (CDN with Fallbacks) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        onerror="loadFallback('node_modules/jquery/dist/jquery.min.js')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"
        onerror="loadFallback('node_modules/@chrisoakman/chessboardjs/dist/chessboard-1.0.0.min.js')"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"
        onerror="loadFallback('./chess.js')"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"
        onerror="loadFallback('node_modules/socket.io-client/dist/socket.io.min.js')"></script>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#38bdf8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Modularized CSS (Development) -->
    <link rel="stylesheet" href="style.css?v=3.5">
</head>

<body>
    <!-- üì± MOBILE WELCOME SCREEN -->
    <div id="mobile-welcome-screen">
        <div class="welcome-header">
            <div id="hamburger-menu-welcome" class="hamburger-icon">‚ò∞</div>
            <img src="logo.jpg" alt="Chess Tricks Logo" class="welcome-logo-small">
            <h1 class="welcome-title">CHESS <span style="color:var(--accent)">TRICKS</span></h1>
            <div class="welcome-user-info">
                <span id="welcome-elo-main">500 ELO</span>
                <span id="welcome-elo-puz">500 üß©</span>
            </div>
        </div>

        <div class="welcome-container">
            <div class="welcome-view active" id="view-main">
                <div class="welcome-menu">
                    <!-- OPCI√ìN PUZZLES -->
                    <div class="welcome-option" id="btn-show-puzzles-view">
                        <div class="welcome-option-icon">üß©</div>
                        <div class="welcome-option-content">
                            <div class="welcome-option-title">Puzzles</div>
                            <div class="welcome-option-desc">T√°ctica diaria y problemas</div>
                        </div>
                        <div class="category-arrow">‚ñ∂</div>
                    </div>

                    <!-- OPCI√ìN JUGAR -->
                    <div class="welcome-option" id="btn-show-play-view">
                        <div class="welcome-option-icon">‚öîÔ∏è</div>
                        <div class="welcome-option-content">
                            <div class="welcome-option-title">Jugar</div>
                            <div class="welcome-option-desc">IA, Online o Amigos</div>
                        </div>
                        <div class="category-arrow">‚ñ∂</div>
                    </div>

                    <!-- OPCI√ìN ESTUDIO -->
                    <div class="welcome-option" id="btn-show-study-view">
                        <div class="welcome-option-icon">üìö</div>
                        <div class="welcome-option-content">
                            <div class="welcome-option-title">Estudio</div>
                            <div class="welcome-option-desc">An√°lisis, Aperturas y Editor</div>
                        </div>
                        <div class="category-arrow">‚ñ∂</div>
                    </div>




                    <!-- MAESTRO IA INFO PREVIEW -->
                    <div class="welcome-coach-preview">
                        <div class="coach-avatar-tiny">üë¥</div>
                        <div class="coach-msg-tiny" id="welcome-coach-tip">
                            "El control del centro es la clave de la victoria."
                        </div>
                    </div>
                </div>
            </div>

            <!-- VISTA: PLAY MENU -->
            <div class="welcome-view" id="view-play">
                <div class="welcome-sub-header">
                    <button class="btn-back-welcome" data-target="view-main">‚óÄ Volver</button>
                    <h3>Modos de Juego</h3>
                </div>
                <div class="welcome-menu">
                    <div class="welcome-option" id="btn-sub-ai">
                        <div class="welcome-option-icon">ü§ñ</div>
                        <div class="welcome-option-content">
                            <div class="welcome-option-title">vs Stockfish</div>
                            <div class="welcome-option-desc">10 Niveles de dificultad</div>
                        </div>
                    </div>
                    <div class="welcome-option" id="btn-sub-online">
                        <div class="welcome-option-icon">üåç</div>
                        <div class="welcome-option-content">
                            <div class="welcome-option-title">Jugar Online</div>
                            <div class="welcome-option-desc">Partidas r√°pidas en vivo</div>
                        </div>
                    </div>
                    <div class="welcome-option" id="btn-sub-friend">
                        <div class="welcome-option-icon">üë•</div>
                        <div class="welcome-option-content">
                            <div class="welcome-option-title">Local / Amigo</div>
                            <div class="welcome-option-desc">Dos jugadores en un m√≥vil</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VISTA: SETUP AI -->
            <div class="welcome-view" id="view-ai-setup">
                <div class="welcome-sub-header">
                    <button class="btn-back-welcome" data-target="view-play">‚óÄ Volver</button>
                    <h3>Configurar IA</h3>
                </div>
                <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:18px;">
                    <label
                        style="color:#94a3b8; font-size:0.8rem; margin-bottom:10px; display:block;">DIFICULTAD</label>
                    <select id="welcome-diff-sel"
                        style="width:100%; padding:12px; border-radius:10px; background:#1e293b; color:white; border:1px solid rgba(255,255,255,0.1); margin-bottom:20px;">
                        <option value="1">Nivel 1 (Principiante)</option>
                        <option value="5" selected>Nivel 5 (Intermedio)</option>
                        <option value="10">Nivel 10 (Gran Maestro)</option>
                    </select>

                    <label style="color:#94a3b8; font-size:0.8rem; margin-bottom:10px; display:block;">COLOR</label>
                    <div style="display:flex; gap:10px; margin-bottom:25px;">
                        <div class="welcome-color-btn active" data-color="random"
                            style="flex:1; padding:15px; text-align:center; background:#334155; border-radius:10px; cursor:pointer;">
                            üé≤</div>
                        <div class="welcome-color-btn" data-color="w"
                            style="flex:1; padding:15px; text-align:center; background:#f8fafc; color:black; border-radius:10px; cursor:pointer;">
                            ‚ôî</div>
                        <div class="welcome-color-btn" data-color="b"
                            style="flex:1; padding:15px; text-align:center; background:#0f172a; color:white; border-radius:10px; cursor:pointer;">
                            ‚ôö</div>
                    </div>

                    <button class="btn-primary" id="btn-welcome-start-ai"
                        style="width:100%; padding:15px; font-size:1.1rem;">JUGAR AHORA</button>
                </div>
            </div>

            <!-- VISTA: STUDY MENU -->
            <div class="welcome-view" id="view-study">
                <div class="welcome-sub-header">
                    <button class="btn-back-welcome" data-target="view-main">‚óÄ Volver</button>
                    <h3>Herramientas de Estudio</h3>
                </div>
                <div class="welcome-menu">
                    <div class="welcome-option" id="btn-sub-analysis">
                        <div class="welcome-option-icon">üîç</div>
                        <div class="welcome-option-content">
                            <div class="welcome-option-title">An√°lisis Maestro</div>
                            <div class="welcome-option-desc">Eval√∫a cualquier posici√≥n</div>
                        </div>
                    </div>
                    <div class="welcome-option" id="btn-sub-openings">
                        <div class="welcome-option-icon">üìñ</div>
                        <div class="welcome-option-content">
                            <div class="welcome-option-title">Aperturas</div>
                            <div class="welcome-option-desc">Aprende l√≠neas te√≥ricas</div>
                        </div>
                    </div>
                    <div class="welcome-option" id="btn-sub-editor">
                        <div class="welcome-option-icon">‚õèÔ∏è</div>
                        <div class="welcome-option-content">
                            <div class="welcome-option-title">Editor de Tablero</div>
                            <div class="welcome-option-desc">Configura posiciones</div>
                        </div>
                    </div>
                    <div class="welcome-option" id="btn-sub-pgn">
                        <div class="welcome-option-icon">üì•</div>
                        <div class="welcome-option-content">
                            <div class="welcome-option-title">Cargar PGN</div>
                            <div class="welcome-option-desc">Importar partida</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VISTA: OPENINGS LIST -->
            <div class="welcome-view" id="view-openings">
                <div class="welcome-sub-header">
                    <button class="btn-back-welcome" data-target="view-study">‚óÄ Volver</button>
                    <h3>Biblioteca de Aperturas</h3>
                </div>
                <div class="welcome-list" id="welcome-openings-list">
                    <!-- Javascript populates this -->
                </div>
            </div>

            <!-- VISTA: PGN INPUT -->
            <div class="welcome-view" id="view-pgn">
                <div class="welcome-sub-header">
                    <button class="btn-back-welcome" data-target="view-study">‚óÄ Volver</button>
                    <h3>Importar PGN</h3>
                </div>
                <textarea id="welcome-pgn-input" placeholder="Pega aqu√≠ tu PGN..."></textarea>
                <button class="btn-primary" id="btn-welcome-load-pgn" style="margin-top:10px;">CARGAR PARTIDA</button>
            </div>

            <!-- VISTA: PUZZLES SETUP -->
            <div class="welcome-view" id="view-puzzles-setup">
                <div class="welcome-sub-header">
                    <button class="btn-back-welcome" data-target="view-main">‚óÄ Volver</button>
                    <h3>Configurar Puzzles</h3>
                </div>
                <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:18px;">
                    <label style="color:#94a3b8; font-size:0.8rem; margin-bottom:10px; display:block;">TEMA
                        T√ÅCTICO</label>
                    <select id="welcome-puz-cat-sel"
                        style="width:100%; padding:12px; border-radius:10px; background:#1e293b; color:white; border:1px solid rgba(255,255,255,0.1); margin-bottom:20px;">
                        <option value="all">Mezclado (Recomendado)</option>
                        <option value="fork">Ataque Doble</option>
                        <option value="pin">Clavada</option>
                        <option value="mate">Jaque Mate</option>
                        <option value="endgame">Finales</option>
                    </select>

                    <button class="btn-primary" id="btn-welcome-start-puzzles"
                        style="width:100%; padding:15px; font-size:1.1rem;">EMPEZAR</button>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM NAV -->
        <div class="bottom-nav">
            <div class="nav-item active" id="nav-home">
                <span class="icon">üè†</span>
                <span>Inicio</span>
            </div>
            <div class="nav-item" id="nav-play">
                <span class="icon">‚öîÔ∏è</span>
                <span>Jugar</span>
            </div>
            <div class="nav-item" id="nav-puzzles">
                <span class="icon">üß©</span>
                <span>Puzzles</span>
            </div>
            <div class="nav-item" id="nav-analysis">
                <span class="icon">üîç</span>
                <span>An√°lisis</span>
            </div>
        </div>
    </div>


    <div class="app-header">
        <div id="hamburger-menu" class="hamburger-icon" style="position:static; font-size:1.5rem;">‚ò∞</div>
        <div class="logo-inline">
            <img src="logo.jpg" alt="Logo" style="height:28px; width:28px; object-fit:contain; border-radius:4px;">
            <h1 style="font-size:0.8rem">CHESS <span style="color:var(--accent)">TRICKS</span></h1>
        </div>
        <div id="header-user-info" style="display:flex; align-items:center; gap:10px;">
            <div id="header-elo" title="ELO Partidas"
                style="background:rgba(34, 197, 94, 0.1); border:1px solid var(--accent); color:var(--accent); padding:2px 8px; border-radius:4px; font-size:0.7rem; font-weight:700;">
                500 ELO</div>
            <div id="header-elo-puz" title="ELO Puzzles"
                style="background:rgba(59, 130, 246, 0.1); border:1px solid #3b82f6; color:#3b82f6; padding:2px 8px; border-radius:4px; font-size:0.7rem; font-weight:700;">
                500üß©</div>
            <div id="btn-auth-trigger" style="cursor:pointer; font-size:0.8rem; color:var(--text-muted);">üë§ Acceder
            </div>
        </div>
    </div>

    <!-- MODALES AUTH -->
    <div class="modal-overlay" id="auth-modal">
        <div class="modal-card">
            <h3 id="auth-title">INICIAR SESI√ìN</h3>
            <div class="input-group">
                <label>USUARIO</label>
                <input type="text" id="auth-user" placeholder="Tu nombre...">
            </div>
            <div class="input-group" id="reg-group" style="display:none;">
                <label>EMAIL</label>
                <input type="email" id="auth-email" placeholder="correo@ejemplo.com">
            </div>
            <div class="input-group">
                <label>CONTRASE√ëA</label>
                <div style="position:relative">
                    <input type="password" id="auth-pass" placeholder="******" autocomplete="current-password"
                        style="padding-right:35px;">
                    <span id="btn-show-pass"
                        style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;">üëÅÔ∏è</span>
                </div>
            </div>
            <!-- GRUPO RESET PASSWORD -->
            <div class="input-group" id="reset-group" style="display:none;">
                <label>EMAIL</label>
                <input type="email" id="reset-email" placeholder="correo@ejemplo.com">
                <label style="margin-top:10px;">C√ìDIGO DE RECUPERACI√ìN</label>
                <input type="text" id="reset-code" placeholder="123456">
                <label style="margin-top:10px;">NUEVA CONTRASE√ëA</label>
                <input type="password" id="reset-pass-new" placeholder="******">
            </div>

            <button class="btn-primary" id="btn-auth-submit">ENTRAR</button>
            <button class="btn-primary" id="btn-reset-submit" style="display:none;">CAMBIAR CONTRASE√ëA</button>

            <p id="auth-forgot"
                style="font-size:0.65rem; text-align:center; margin-top:10px; cursor:pointer; color:var(--text-muted); text-decoration: underline;">
                ¬øOlvidaste tu contrase√±a?
            </p>
            <p id="auth-privacy" style="font-size:0.6rem; color:var(--text-muted); margin-top:10px; text-align:center;">
                üîí Tus datos se cifran y guardan de forma segura conforme a la normativa de privacidad.
            </p>
            <p id="auth-switch"
                style="font-size:0.7rem; text-align:center; margin-top:15px; cursor:pointer; color:var(--text-muted);">
                ¬øNo tienes cuenta? <span style="color:var(--accent)">Reg√≠strate</span></p>

            <button class="btn-tool" id="btn-auth-close" style="width:100%; margin-top:10px;">CERRAR</button>
        </div>
    </div>

    <div id="side-drawer-overlay"></div>
    <div id="side-drawer">
        <!-- SECCI√ìN NAVEGACI√ìN (NUEVA) -->
        <div class="drawer-section" style="margin-bottom:20px;">
            <label class="label-tiny">MEN√ö PRINCIPAL</label>
            <div style="display:flex; flex-direction:column; gap:8px;">
                <button class="btn-drawer-nav" data-target="home" style="text-align:left;">üè† Inicio</button>
                <button class="btn-drawer-nav" data-target="play" style="text-align:left;">‚öîÔ∏è Jugar</button>
                <button class="btn-drawer-nav" data-target="study" style="text-align:left;">üìö Estudio</button>
                <button class="btn-drawer-nav" data-target="puzzles" style="text-align:left;">üß© Puzzles</button>
            </div>
        </div>

        <div class="drawer-section" style="margin-bottom:20px;">
            <label class="label-tiny" id="lbl-user">üë§ USUARIO</label>
            <div id="drawer-user-card"
                style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; display:flex; flex-direction:column; gap:8px;">
                <div id="drawer-user-name" style="font-weight:700; color:var(--accent);">Invitado</div>
                <div id="drawer-user-elo" style="font-size:0.7rem; color:var(--text-muted);">ELO: 500</div>
                <button class="btn-primary" id="btn-auth-drawer" style="padding:8px; font-size:0.65rem;">ACCEDER /
                    REGISTRO</button>
                <button class="btn-danger" id="btn-logout-drawer"
                    style="padding:8px; font-size:0.65rem; display:none;">CERRAR SESI√ìN</button>
            </div>
        </div>

        <div class="drawer-section" style="margin-bottom:20px;">
            <label class="label-tiny" id="lbl-appearance">üé® APARIENCIA</label>
            <div style="margin-bottom:10px;">
                <label style="font-size:0.6rem; color:var(--text-muted);" id="lbl-board">Tablero</label>
                <select class="btn-control" id="board-theme-sel">
                    <option value="classic">Cl√°sico (Azul)</option>
                    <option value="wood">Madera</option>
                    <option value="neon">Neon Dark</option>
                    <option value="forest">Bosque</option>
                </select>
            </div>
            <div>
                <label style="font-size:0.6rem; color:var(--text-muted);" id="lbl-pieces">Piezas</label>
                <select class="btn-control" id="piece-theme-sel">
                    <option value="wikipedia">Wikipedia</option>
                    <option value="alpha">Alpha</option>
                    <option value="uscf">USCF</option>
                </select>
            </div>
        </div>

        <div class="drawer-section" style="margin-bottom:20px;">
            <label class="label-tiny" id="lbl-lang">üåê IDIOMA / LANGUAGE</label>
            <select class="btn-control" id="lang-sel">
                <option value="es">Espa√±ol</option>
                <option value="en">English</option>
            </select>
        </div>

        <div class="drawer-item" id="btn-toggle-sound"
            style="cursor:pointer; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.05);">üîä Sonidos: ON</div>
        <div style="padding:10px 0;">
            <a href="privacy.html" style="color:var(--text-muted); font-size:0.65rem; text-decoration:none;"
                target="_blank">üìú Pol√≠tica de Privacidad</a>
        </div>
        <div style="margin-top:auto; font-size:0.6rem; color:var(--text-muted);">V 3.0 FIX - Cloud Edition</div>
    </div>

    <div class="app-container">
        <aside class="sidebar-left">
            <h2 class="app-title">CHESS <span style="color:var(--accent)">TRICKS</span></h2>

            <div class="mode-selectors">
                <div class="mode-pill active" data-mode="local" title="Jugar contra otro (PC/Online)">üë• VS</div>
                <div class="mode-pill" data-mode="ai" title="Jugar contra Stockfish">ü§ñ IA</div>
                <div class="mode-pill" data-mode="study" title="Analizar, Editor, Aperturas">üìö ESTUDIO</div>
                <div class="mode-pill" data-mode="exercises" title="Resolver Puzzles T√°cticos">üß© T√ÅCTICA</div>
            </div>

            <!-- SECCI√ìN JUGAR (LOCAL/ONLINE) -->
            <div class="mode-section active" id="sec-local">
                <label class="label-tiny">JUGAR ONLINE</label>
                <button class="btn-primary" id="btn-create" style="margin-bottom:10px;">Crear Reto Online</button>
                <input type="text" id="game-id-input" placeholder="ID de partida..."
                    style="width:100%; padding:8px; margin-bottom:5px; background:rgba(255,255,255,0.1); border:none; color:white;">
                <button class="btn-tool" id="btn-join" style="width:100%;">Unirse</button>

                <div style="margin-top:20px;">
                    <label class="label-tiny">JUGAR LOCAL</label>
                    <button class="btn-tool" id="btn-start-local-friend" style="width:100%;">Partida vs Amigo</button>
                </div>
            </div>

            <!-- SECCI√ìN IA -->
            <div class="mode-section" id="sec-ai">
                <label class="label-tiny">DIFICULTAD (Nivel 1-20)</label>
                <input type="range" id="diff-sel" min="1" max="20" value="5" style="width:100%; margin-bottom:10px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.7rem;">
                    <span>F√°cil</span><span>Medio</span><span>GM</span>
                </div>

                <label class="label-tiny">COLOR</label>
                <select class="btn-control" id="ai-color-sel" style="margin-bottom:15px;">
                    <option value="random">Aleatorio</option>
                    <option value="w">Blancas ‚ôî</option>
                    <option value="b">Negras ‚ôö</option>
                </select>

                <button class="btn-primary" id="btn-start-ai">Jugar vs IA</button>
            </div>

            <!-- SECCI√ìN ESTUDIO -->
            <div class="mode-section" id="sec-study">
                <label class="label-tiny">APERTURAS</label>
                <select class="btn-control" id="opening-sel" style="margin-bottom:10px;">
                    <option value="">Seleccionar apertura...</option>
                </select>

                <label class="label-tiny">HERRAMIENTAS</label>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                    <button class="btn-tool" id="btn-editor">Editor</button>
                    <button class="btn-tool" id="btn-pgn">PGN</button>
                    <button class="btn-tool" id="btn-fen">FEN</button>
                    <button class="btn-tool" id="btn-analyze">Analizar</button>
                </div>

                <div id="study-best-move-text"
                    style="margin-top:15px; font-size:0.8rem; color:#86efac; min-height:20px;"></div>
            </div>

            <!-- SECCI√ìN PUZZLES -->
            <div class="mode-section" id="sec-exercises">
                <label class="label-tiny">CATEGOR√çA</label>
                <select class="btn-control" id="puz-cat-sel" style="margin-bottom:15px;">
                    <option value="all">Mezclado</option>
                    <option value="fork">Ataque Doble</option>
                    <option value="pin">Clavada</option>
                    <option value="mate">Mate</option>
                    <option value="endgame">Finales</option>
                </select>

                <div
                    style="background:rgba(0,0,0,0.3); padding:10px; border-radius:6px; margin-bottom:15px; text-align:center;">
                    <div id="puz-timer" style="font-family:monospace; font-size:1.2rem; color:var(--accent);">00:00
                    </div>
                    <div id="puz-desc" style="font-size:0.75rem; color:#94a3b8; margin-top:5px;">Resuelve el t√°ctico...
                    </div>
                </div>

                <button class="btn-primary" id="btn-next-puz" style="margin-bottom:10px;">Siguiente Puzzle</button>
                <div style="display:flex; gap:5px;">
                    <button class="btn-tool" id="btn-puz-hint">Pista</button>
                    <button class="btn-tool" id="btn-show-sol" style="color:var(--text-muted);">Soluci√≥n</button>
                </div>
            </div>
        </aside>

        <section class="game-zone">
            <!-- INFO JUGADORES / RELOJES -->
            <div class="board-header"
                style="width:100%; max-width:480px; display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:5px;">
                <div class="player-info">
                    <span id="opp-avatar">üë§</span> <span id="opp-name">Oponente</span>
                </div>
                <div class="timer-box" id="opp-timer">10:00</div>
            </div>

            <!-- TABLERO -->
            <div id="myBoard"></div>

            <div class="board-footer"
                style="width:100%; max-width:480px; display:flex; justify-content:space-between; align-items:flex-start; margin-top:5px;">
                <div class="player-info">
                    <span id="my-avatar">üë§</span> <span id="my-name">T√∫</span>
                </div>
                <div class="timer-box" id="my-timer">10:00</div>
            </div>

            <!-- CONTROLES -->
            <div style="position: relative; width: 100%; max-width: 480px;">
                <div class="nav-toolbar">
                    <button class="btn-nav" id="btn-nav-first" title="Inicio">‚èÆ</button>
                    <button class="btn-nav" id="btn-nav-prev" title="Anterior">‚óÄ</button>
                    <button class="btn-nav" id="btn-nav-next" title="Siguiente">‚ñ∂</button>
                    <button class="btn-nav" id="btn-nav-last" title="Fin">‚è≠</button>
                    <button class="btn-nav mobile-only" id="btn-more-options" title="M√°s">‚ãÆ</button>
                </div>

                <!-- MEN√ö DESPLEGABLE DE ACCIONES M√ìVIL (CORREGIDO POSICIONAMIENTO) -->
                <div id="mobile-actions-menu" class="glass-dropdown">
                    <button class="dropdown-item" id="btn-flip-mobile">üîÑ Girar Tablero</button>
                    <button class="dropdown-item" id="btn-analyze-mobile">üîç Analizar</button>
                    <button class="dropdown-item" id="btn-hint-mobile">üí° Pista IA</button>
                    <button class="dropdown-item" id="btn-editor-mobile">‚õèÔ∏è Editor</button>
                    <button class="dropdown-item" id="btn-welcome-mobile"
                        style="color:var(--accent); border-top:1px solid rgba(255,255,255,0.1)">üè† Men√∫
                        Principal</button>
                </div>
            </div>

            <!-- COACH PANEL (FLOTANTE O INLINE) -->
            <div class="coach-panel" style="width:100%; max-width:480px; margin-top:10px;">
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px;">
                    <div class="coach-avatar">üë¥</div>
                    <div class="coach-bubble">
                        <div id="material-display"
                            style="font-size:0.65rem; font-weight:700; color:#cbd5e1; margin-bottom:2px; text-transform:uppercase;">
                            IGUALDAD</div>
                        <span id="coach-txt">Bienvenido. ¬øListo para aprender?</span>
                    </div>
                </div>

                <!-- BARRA EVALUACI√ìN -->
                <div class="eval-bar-container">
                    <div class="eval-bar-fill" id="eval-fill-master" style="height:50%;"></div>
                </div>
            </div>

            <div id="best-move-display" class="best-move-box"></div>

            <!-- TOOLS BAR (PC ONLY MOSTLY) -->
            <div class="tools-bar mobile-hidden"
                style="margin-top:15px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
                <button class="btn-tool" id="btn-flip">‚Ü∫ Girar</button>
                <button class="btn-tool" id="btn-reset">‚ü≥ Nuevo</button>
                <button class="btn-tool" id="btn-ai-hint" title="Pedir sugerencia a Stockfish">üí° Pista</button>
                <button class="btn-danger-outline" id="btn-resign-local">üè≥ Rendirse</button>
            </div>
        </section>

        <aside class="sidebar-right">
            <div class="tabs-header">
                <button class="tab-btn active" data-tab="tab-moves">Movimientos</button>
                <button class="tab-btn" data-tab="tab-chat">Chat</button>
                <button class="tab-btn" data-tab="tab-history">Historial</button>
                <button class="tab-btn" data-tab="tab-ranking">Ranking</button>
            </div>

            <div class="tab-content">
                <div id="tab-moves" class="tab-pane active">
                    <!-- PGN MOVE LIST -->
                    <div id="pgn-container"
                        style="font-family:monospace; font-size:0.85rem; line-height:1.6; color:#cbd5e1; height:100%; overflow-y:auto; padding:5px;">
                        1. e4 ...
                    </div>
                </div>
                <div id="tab-chat" class="tab-pane">
                    <div id="chat-msgs"
                        style="height:200px; overflow-y:auto; background:rgba(0,0,0,0.2); border-radius:8px; padding:10px; margin-bottom:10px;">
                    </div>
                    <div style="display:flex; gap:5px;">
                        <input type="text" id="chat-input" placeholder="Mensaje..."
                            style="flex:1; background:rgba(255,255,255,0.05); border:none; color:white; padding:8px; border-radius:4px;">
                        <button class="btn-tool" id="btn-send-chat">Enviar</button>
                    </div>
                </div>
                <div id="tab-history" class="tab-pane">
                    <div style="text-align:center; color:#94a3b8; font-size:0.8rem; padding:20px;">
                        Inicia sesi√≥n para ver tu historial de partidas.
                    </div>
                </div>
                <div id="tab-ranking" class="tab-pane">
                    <div style="text-align:center; padding:10px;">
                        <h4 style="color:var(--accent); margin-bottom:10px;">üèÜ Top Jugadores</h4>
                        <div id="ranking-list" style="display:flex; flex-direction:column; gap:8px;">
                            <!-- Populated by JS -->
                            <div
                                style="display:flex; justify-content:space-between; padding:8px; background:rgba(255,255,255,0.05); border-radius:6px;">
                                <span>1. MaestroIA</span> <span style="font-weight:bold; color:#fbbf24;">2800</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <script src="dist/main.js?v=3.5"></script>

    <!-- Service Worker Registration at end of body if not in main.js -->
</body>

</html>