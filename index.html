<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chess Drez | Maestro IA & Puzzles</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ôüÔ∏è</text></svg>">

    <!-- LIBRER√çAS -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link rel="manifest" href="manifest.json">
    <script src="puzzles_data.js"></script>
    <script src="openings_enhanced.js"></script>
    <script src="knowledge_base.js"></script>
    <meta name="theme-color" content="#00bcd4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="toast-container"></div>
    <div id="mobile-panel-overlay"></div>

    <header class="app-header">
        <div class="header-left">
            <div id="hamburger-menu">‚ò∞</div>
            <div class="logo-area" onclick="goBackToMenu()">
                <img src="logo.jpg" alt="Logo" class="logo-img">
                <span class="logo-text">Chess <span class="accent-text">Drez</span></span>
            </div>
        </div>

        <nav class="header-center desktop-only">
            <div class="nav-center-link active" onclick="goBackToMenu()">Inicio</div>
            <div class="nav-center-link" onclick="showSubMenu('jugar')">Jugar</div>
            <div class="nav-center-link" onclick="showSubMenu('estudio')">Aprender</div>
            <div class="nav-center-link" onclick="showSubMenu('puzzles')">T√°cticas</div>
        </nav>

        <div class="header-right">
            <div class="user-stats">
                <div class="stat-item">
                    <span class="stat-label">Rango</span>
                    <span class="stat-val" style="color:var(--warning)">Grandmaster</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Elo</span>
                    <span class="stat-val" id="header-elo">500</span>
                </div>
            </div>
            <div id="btn-auth-trigger" class="auth-btn">üë§ Acceder</div>
        </div>
    </header>

    <div class="main-layout">
        <!-- SIDEBAR IZQUIERDA -->
        <nav class="sidebar">
            <div class="nav-links">
                <div class="nav-item" onclick="goBackToMenu()" id="nav-home">
                    <span class="nav-icon">üè†</span>
                    <span class="nav-text">Inicio</span>
                </div>
                <div class="nav-item" onclick="showSubMenu('jugar')" id="nav-jugar">
                    <span class="nav-icon">‚öîÔ∏è</span>
                    <span class="nav-text">Jugar</span>
                </div>
                <div class="nav-item" onclick="showSubMenu('estudio')" id="nav-aprender">
                    <span class="nav-icon">üéì</span>
                    <span class="nav-text">Aprender</span>
                </div>
                <div class="nav-item" onclick="showSubMenu('puzzles')" id="nav-tacticas">
                    <span class="nav-icon">üß©</span>
                    <span class="nav-text">T√°cticas</span>
                </div>
            </div>

            <!-- APERTURAS SELECTOR CONTAINER -->
            <div id="opening-sel-container" style="display:none; padding:10px 20px; background: rgba(0,0,0,0.2);">
                <label
                    style="font-size:0.6rem; color:var(--text-dim); font-weight:800; display:block; margin-bottom:5px;">SELECCIONAR
                    APERTURA</label>
                <select id="opening-sel-main" class="custom-select">
                    <option value="">-- Elige una --</option>
                </select>
                <select id="opening-sel" style="display:none;"></select> <!-- Legacy hidden sync -->
            </div>

            <div class="sidebar-bottom">
                <div class="appearance-settings">
                    <label>TABLERO</label>
                    <select id="board-theme-sel" class="custom-select" style="margin-bottom:12px;">
                        <option value="classic">Cl√°sico (Azul)</option>
                        <option value="wood">Madera</option>
                        <option value="neon">Neon Dark</option>
                        <option value="forest">Bosque</option>
                    </select>

                    <label>PIEZAS</label>
                    <select id="piece-theme-sel" class="custom-select" style="margin-bottom:12px;">
                        <option value="wikipedia">Wikipedia</option>
                        <option value="alpha">Alpha</option>
                        <option value="uscf">USCF</option>
                    </select>

                    <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                        <label style="margin-bottom:0;">MEJORES JUGADAS</label>
                        <label class="toggle-switch-small">
                            <input type="checkbox" id="sidebar-toggle-best-moves" checked
                                onchange="toggleBestMoves(this.checked)">
                            <span class="slider-small"></span>
                        </label>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ZONA DE JUEGO (CENTRO) -->
        <main class="game-zone">
            <!-- Men√∫s Emergentes / Submen√∫s -->
            <div id="submenus-container">
                <div class="menu-step active" id="menu-home">
                    <div class="hero-section">
                        <div class="hero-content">
                            <h1 class="hero-title">Domina el Tablero con <span class="accent-text">Maestro IA</span>
                            </h1>
                            <p class="hero-subtitle">La plataforma de ajedrez definitiva para aprender, entrenar y
                                competir con tecnolog√≠a de vanguardia.</p>

                            <ul class="hero-features-list">
                                <li>‚ú® Motor Stockfish 16 Core</li>
                                <li>üìä An√°lisis Multi-l√≠nea en tiempo real</li>
                                <li>üß© +2,800 Puzzles T√°cticos</li>
                                <li>‚öîÔ∏è Partidas Online y Locales</li>
                            </ul>

                            <div class="hero-actions mobile-hidden">
                                <button class="btn-hero-primary" onclick="showSubMenu('jugar')">Empezar a Jugar</button>
                                <button class="btn-hero-secondary" onclick="showSubMenu('estudio')">Ver
                                    Tutoriales</button>
                            </div>

                            <!-- MENU MOVIL EXCLUSIVO -->
                            <div class="mobile-start-menu">
                                <button class="btn-mobile-menu primary" onclick="showSubMenu('jugar')">
                                    <span class="icon">‚öîÔ∏è</span> JUGAR
                                </button>
                                <button class="btn-mobile-menu" onclick="showSubMenu('estudio')">
                                    <span class="icon">üéì</span> APRENDER
                                </button>
                                <button class="btn-mobile-menu" onclick="showSubMenu('puzzles')">
                                    <span class="icon">üß©</span> T√ÅCTICAS
                                </button>
                                <button class="btn-mobile-menu" onclick="showSubMenu('aperturas')">
                                    <span class="icon">üìã</span> APERTURAS
                                </button>
                            </div>

                            <div class="quick-stats-row mobile-hidden">
                                <div class="q-stat-card">
                                    <span class="q-val">2.8k+</span>
                                    <span class="q-lab">Puzzles</span>
                                </div>
                                <div class="q-stat-card">
                                    <span class="q-val">100%</span>
                                    <span class="q-lab">Gratis</span>
                                </div>
                                <div class="q-stat-card">
                                    <span class="q-val">Stockfish 16</span>
                                    <span class="q-lab">Motor IA</span>
                                </div>
                            </div>
                        </div>
                        <div class="hero-visual mobile-hidden">
                            <div class="hero-board-preview forming">
                                <img src="chess_hero_preview.png" alt="Preview" class="hero-img-preview">
                                <div class="hero-scanner-line"></div>
                                <div class="hero-glass-badge">Powered by AI</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="menu-step" id="menu-root">
                    <!-- Base root menu is now integrated into sidebar, but we keep the logic -->
                </div>

                <div class="menu-step" id="menu-jugar">
                    <div class="menu-header-mobile">
                        <button class="btn-back-arrow" onclick="goBackToMenu()">‚Üê</button>
                        <h3 class="menu-title">Seleccionar Modo</h3>
                    </div>
                    <div class="grid-menu">
                        <div class="card-option" onclick="showSubMenu('maestro-config')">
                            <span class="opt-icon">üéì</span>
                            <h4>Maestro IA</h4>
                        </div>
                        <div class="card-option" onclick="setMode('local')">
                            <span class="opt-icon">‚öîÔ∏è</span>
                            <h4>Partida Online</h4>
                        </div>
                        <div class="card-option" onclick="setMode('pass-and-play')">
                            <span class="opt-icon">üë•</span>
                            <h4>Juego Local</h4>
                        </div>
                    </div>
                </div>

                <!-- CONFIGURACI√ìN MAESTRO IA -->
                <div class="menu-step" id="menu-maestro-config">
                    <div class="menu-header-mobile">
                        <button class="btn-back-arrow" onclick="showSubMenu('jugar')">‚Üê</button>
                        <h3 class="menu-title">Configurar Partida IA</h3>
                    </div>

                    <div class="config-container">
                        <!-- DIFICULTAD -->
                        <div class="config-group">
                            <div class="config-label-row">
                                <label>NIVEL DE IA</label>
                                <span id="diff-display"
                                    style="color:var(--accent); font-weight:700;">Principiante</span>
                            </div>
                            <div class="difficulty-bar" id="diff-selector">
                                <!-- Generated by JS or static -->
                                <div class="diff-seg" data-lvl="0" onclick="selectDifficulty(0)"></div>
                                <div class="diff-seg" data-lvl="1" onclick="selectDifficulty(1)"></div>
                                <div class="diff-seg" data-lvl="2" onclick="selectDifficulty(2)"></div>
                                <div class="diff-seg" data-lvl="3" onclick="selectDifficulty(3)"></div>
                                <div class="diff-seg" data-lvl="4" onclick="selectDifficulty(4)"></div>
                                <div class="diff-seg" data-lvl="5" onclick="selectDifficulty(5)"></div>
                                <div class="diff-seg" data-lvl="10" onclick="selectDifficulty(10)"></div>
                                <div class="diff-seg" data-lvl="15" onclick="selectDifficulty(15)"></div>
                                <div class="diff-seg" data-lvl="20" onclick="selectDifficulty(20)"></div>
                            </div>
                            <p class="config-desc" id="diff-desc">ELO Aprox: 300</p>
                        </div>

                        <!-- TIEMPO -->
                        <div class="config-group">
                            <label>CONTROL DE TIEMPO</label>
                            <div class="option-row">
                                <button class="btn-option" onclick="selectTime('3+2')">‚ö° 3+2</button>
                                <button class="btn-option active" onclick="selectTime('10+0')">‚è±Ô∏è 10 min</button>
                                <button class="btn-option" onclick="selectTime('30+0')">üê¢ 30 min</button>
                                <button class="btn-option" onclick="selectTime('unlimited')">‚ôæÔ∏è Sin L√≠mite</button>
                            </div>
                        </div>

                        <!-- COLOR -->
                        <div class="config-group">
                            <label>JUGAR COMO</label>
                            <div class="option-row color-selector">
                                <button class="btn-option active" onclick="selectSide('white')">‚ö™ Blancas</button>
                                <button class="btn-option" onclick="selectSide('random')">üé≤ Azar</button>
                                <button class="btn-option" onclick="selectSide('black')">‚ö´ Negras</button>
                            </div>
                        </div>

                        <button class="btn-action-primary start-game-btn" onclick="launchMaestroGame()">
                            COMENZAR PARTIDA
                        </button>
                    </div>
                </div>

                <div class="menu-step" id="menu-estudio">
                    <div class="menu-header-mobile">
                        <button class="btn-back-arrow" onclick="goBackToMenu()">‚Üê</button>
                        <h3 class="menu-title">Estudio y Teor√≠a</h3>
                    </div>
                    <div class="grid-menu">
                        <div class="card-option" onclick="showSubMenu('aperturas')">
                            <span class="opt-icon">üìã</span>
                            <h4>Aperturas</h4>
                            <p style="font-size:0.6rem; opacity:0.6;">Teor√≠a, Entrenamiento y Retos</p>
                        </div>
                        <div class="card-option" onclick="setMode('study')">
                            <span class="opt-icon">üîç</span>
                            <h4>An√°lisis Libre</h4>
                        </div>
                    </div>
                </div>

                <div class="menu-step" id="menu-aperturas">
                    <div class="menu-header-mobile">
                        <button class="btn-back-arrow" onclick="showSubMenu('estudio')">‚Üê</button>
                        <h3 class="menu-title">M√≥dulo de Aperturas</h3>
                    </div>

                    <div class="opening-selection-container"
                        style="padding:15px; display:flex; flex-direction:column; gap:15px;">
                        <div class="sel-group">
                            <label
                                style="font-size:0.6rem; color:var(--accent); font-weight:800; display:block; margin-bottom:8px;">1.
                                SELECCIONAR APERTURA O DEFENSA</label>
                            <select id="opening-module-sel" class="custom-select"
                                style="width:100% !important; padding:12px;">
                                <option value="">-- Buscar Apertura... --</option>
                            </select>
                        </div>

                        <div class="sel-group" style="padding-top:10px; border-top:1px solid rgba(255,255,255,0.05);">
                            <label
                                style="font-size:0.6rem; color:var(--trap-color); font-weight:800; display:block; margin-bottom:8px;">2.
                                TRAMPAS Y MATES T√çPICOS</label>
                            <select id="opening-traps-sel" class="custom-select"
                                style="width:100% !important; padding:12px; border-color:rgba(239,68,68,0.3);">
                                <option value="">-- Elige una trampa o mate... --</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid-menu">
                        <div class="card-option" onclick="startOpeningModule('theory')">
                            <span class="opt-icon">üìñ</span>
                            <h4>1. Teor√≠a</h4>
                            <p style="font-size:0.6rem; opacity:0.6;">Movimientos, celadas y planes</p>
                        </div>
                        <div class="card-option" onclick="startOpeningModule('training')">
                            <span class="opt-icon">üéØ</span>
                            <h4>2. Entrenamiento</h4>
                            <p style="font-size:0.6rem; opacity:0.6;">Pr√°ctica vs IA (Sigue la l√≠nea)</p>
                        </div>
                        <div class="card-option" onclick="startOpeningModule('exercises')">
                            <span class="opt-icon">üß©</span>
                            <h4>3. Ejercicios</h4>
                            <p style="font-size:0.6rem; opacity:0.6;">Situaciones t√≠picas y t√°cticas</p>
                        </div>
                    </div>
                </div>

                <div class="menu-step" id="menu-puzzles">
                    <div class="menu-header-mobile">
                        <button class="btn-back-arrow" onclick="goBackToMenu()">‚Üê</button>
                        <h3 class="menu-title">Entrenar T√°cticas</h3>
                    </div>
                    <!-- Configuraci√≥n de Puzzles (Restaurada a formato simple) -->
                    <div class="puzzles-config" style="margin-top: 20px;">
                        <label
                            style="font-size: 0.7rem; color: var(--text-dim); font-weight: 800; display: block; margin-bottom: 8px;">CATEGOR√çA
                            DE PUZZLE</label>
                        <select id="puz-cat-sel" class="custom-select" style="padding: 12px; margin-bottom: 15px;">
                            <option value="all">Mezclados (Todos)</option>
                            <option value="mate">Mate</option>
                            <option value="fork">Doble / Horquilla</option>
                            <option value="pin">Clavada</option>
                            <option value="sacrifice">Sacrificio</option>
                            <option value="opening">Apertura</option>
                            <option value="middlegame">Medio Juego</option>
                            <option value="endgame">Finales</option>
                        </select>
                        <button class="btn-action-primary" style="width: 100%; border-radius: 12px; padding: 15px;"
                            onclick="setMode('exercises'); loadRandomPuzzle();">
                            EMPEZAR ENTRENAMIENTO
                        </button>
                    </div>

                    <!-- Puzzles Statistics & History -->
                    <div class="puzzles-stats-container">
                        <div class="puz-stats-header">
                            <span>üìä TUS ESTAD√çSTICAS</span>
                            <span id="puz-elo-display" style="color:var(--accent); font-weight:800;">500üß©</span>
                        </div>
                        <div id="puz-stats-list" class="puz-stats-grid">
                            <!-- Themes stats will be injected here -->
                        </div>

                        <div class="puz-history-header">üïí √öLTIMOS ACERTADOS</div>
                        <div id="puz-history-list" class="puz-history-list">
                            <!-- History items will be injected here -->
                        </div>
                    </div>
                </div>
            </div>

            <div id="board-layout" class="board-wrapper">
                <!-- Mobile Move Quality Timeline -->
                <div class="mobile-move-timeline" id="mobile-move-timeline">
                    <!-- Moves will be added here dynamically -->
                </div>

                <!-- Mobile Info Card (above board) -->
                <div class="mobile-board-info">
                    <div class="mobile-opening-badge">
                        <span class="opening-icon">üìñ</span>
                        <span id="mobile-opening-quick">Posici√≥n Inicial</span>
                    </div>
                    <div class="mobile-coach-comment" id="mobile-coach-quick">
                        Comienza la partida...
                    </div>
                </div>

                <div class="player-top">
                    <div class="user-meta">
                        <span id="opp-avatar" class="avatar-circle">üë§</span>
                        <span id="opp-name">Oponente</span>
                    </div>
                    <div id="opp-timer" class="timer-display">10:00</div>
                </div>

                <div class="board-container">
                    <div class="eval-bar-vertical">
                        <div id="eval-fill-master" class="eval-fill"></div>
                    </div>
                    <div class="board-relative">
                        <div id="myBoard"></div>
                        <canvas id="arrowCanvas"></canvas>

                        <div id="game-overlay">
                            <h2 id="overlay-msg">JAQUE MATE</h2>
                            <button onclick="$('#game-overlay').fadeOut()" class="btn-close">Continuar</button>
                        </div>
                    </div>
                </div>

                <div class="player-bottom">
                    <div class="user-meta">
                        <span id="my-avatar" class="avatar-circle active">üë§</span>
                        <span id="my-name-display">Invitado</span>
                    </div>
                    <div id="my-timer" class="timer-display">10:00</div>
                </div>

                <div class="nav-controls">
                    <button class="ctrl-btn mobile-only-btn" id="btn-mobile-back" onclick="goBackToMenu()">üè†</button>
                    <button class="ctrl-btn" id="btn-nav-first">‚èÆ</button>
                    <button class="ctrl-btn" id="btn-nav-prev">‚óÄ</button>
                    <button class="ctrl-btn" id="btn-nav-next">‚ñ∂</button>
                    <button class="ctrl-btn" id="btn-nav-last">‚è≠</button>
                    <button class="ctrl-btn" id="btn-flip">üîÑ</button>
                </div>

                <!-- CONTROLES DE PUZZLE (REUBICADOS BAJO EL TABLERO) -->
                <div id="puzzle-controls" class="puzzle-controls" style="display:none; margin-top: 15px;">
                    <div class="puz-info-row" style="margin-bottom:10px;">
                        <div id="puz-desc-main" class="puz-description-main">Cargando puzzle...</div>
                        <div id="puz-timer-main" class="puz-timer-main" style="margin-left:auto;">00:00</div>
                    </div>
                    <div class="puz-actions-row">
                        <button class="btn-puzzle-action" onclick="showPuzzleHint()">
                            <span class="icon">üí°</span> Pista
                        </button>
                        <button class="btn-puzzle-action danger" onclick="showPuzzleSolution()">
                            <span class="icon">üîì</span> Soluci√≥n
                        </button>
                        <button class="btn-puzzle-action primary" onclick="loadRandomPuzzle()">
                            Siguiente <span class="icon">‚ûî</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Mobile Side Tabs -->
        <div class="mobile-side-tab mobile-tab-right">
            <div class="tab-icon">üìä</div>
            <div class="tab-label">INFO</div>
        </div>

        <!-- Mobile Info Modal -->
        <div id="mobile-info-modal" class="mobile-info-modal">
            <div class="mobile-info-header">
                <h3>Informaci√≥n de Partida</h3>
                <button class="mobile-close-btn" onclick="closeMobileInfo()">‚úï</button>
            </div>
            <div class="mobile-info-content">
                <!-- Analysis Section -->
                <div class="mobile-info-section">
                    <h4>üìä An√°lisis</h4>
                    <div id="mobile-eval-display">
                        <div class="eval-bar-horizontal">
                            <div id="mobile-eval-fill" class="eval-fill-h"></div>
                            <span id="mobile-eval-text">0.0</span>
                        </div>
                        <div class="mobile-stats">
                            <span>Precisi√≥n: <strong id="mobile-accuracy">--</strong></span>
                            <span>Profundidad: <strong id="mobile-depth">--</strong></span>
                        </div>
                    </div>
                </div>

                <!-- Best Moves Section -->
                <div class="mobile-info-section">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <h4 style="margin:0;">üéØ Mejores Jugadas</h4>
                        <label class="toggle-switch-small">
                            <input type="checkbox" id="mobile-toggle-best-moves" checked
                                onchange="toggleBestMoves(this.checked)">
                            <span class="slider-small"></span>
                        </label>
                    </div>
                    <div id="mobile-best-moves"></div>
                </div>

                <!-- Opening Section -->
                <div class="mobile-info-section">
                    <h4>üéì Perspectiva del Maestro</h4>
                    <div class="maestro-insight-card-mobile">
                        <div style="margin-bottom:8px;"><strong>Apertura:</strong> <span
                                id="mobile-maestro-opening">--</span></div>
                        <div style="margin-bottom:8px;"><strong>Plan:</strong>
                            <p id="mobile-maestro-plan" style="font-size:0.85rem; color:var(--text-secondary);">--</p>
                        </div>
                        <div id="mobile-maestro-trap-box"
                            style="display:none; background:rgba(239,68,68,0.1); padding:10px; border-radius:8px; border:1px solid #ef4444;">
                            <strong style="color:#ef4444;">üö® Trampa Detectada:</strong>
                            <p id="mobile-maestro-trap" style="font-size:0.8rem; margin:5px 0 0 0;"></p>
                        </div>
                    </div>
                </div>

                <!-- Coach Logs Section -->
                <div class="mobile-info-section">
                    <h4>üí¨ Logs del Maestro</h4>
                    <div id="mobile-coach-logs"></div>
                </div>
            </div>
        </div>

        <!-- PANEL LATERAL (DERECHA) -->
        <aside class="side-panel">
            <section id="sec-exercises" class="mode-section">
                <div class="section-header">
                    <h3>üß© Modo T√°ctico</h3>
                </div>
                <div id="puz-side-stats"
                    style="padding:10px; font-size:0.75rem; color:var(--text-dim); border-top:1px solid var(--border); margin-top:10px;">
                    Est√°s en modo de entrenamiento t√°ctico. Mejora tu agudeza visual analizando cada posici√≥n.
                </div>
            </section>

            <div class="panel-section opening-info">
                <div class="panel-header">
                    <h3>üí° Perspectiva del Maestro</h3>
                </div>
                <div class="maestro-insight-card">
                    <div class="insight-group">
                        <span class="insight-label">üìä APERTURA:</span>
                        <div id="maestro-opening-name" class="insight-val">Analizando...</div>
                    </div>
                    <div class="insight-group">
                        <span class="insight-label">üß† PLAN:</span>
                        <div id="maestro-plan" class="insight-val">Desarrollando estructura...</div>
                    </div>
                    <div class="insight-group trap-alert" id="maestro-trap-container" style="display:none;">
                        <span class="insight-label">üö® ALERTA:</span>
                        <div id="maestro-trap" class="insight-val warning-text">Ninguna amenaza detectada.</div>
                    </div>
                </div>
            </div>

            <div class="panel-section evaluation-viz">
                <div class="panel-header">
                    <h3>An√°lisis en Tiempo Real</h3>
                    <div id="engine-status" class="status-indicator">ON</div>
                </div>

                <div class="eval-bar-horizontal">
                    <div id="eval-bar-fill" class="eval-fill-h"></div>
                    <span id="eval-text-overlay">0.0</span>
                </div>

                <div class="eval-stats-grid">
                    <div class="eval-stat">
                        <span class="stat-label">Precisi√≥n</span>
                        <span class="stat-value" id="eval-accuracy">--</span>
                    </div>
                    <div class="eval-stat">
                        <span class="stat-label">Profundidad</span>
                        <span class="stat-value" id="eval-depth">18</span>
                    </div>
                </div>
            </div>

            <div class="panel-section top-moves">
                <div class="panel-header">
                    <h3>Mejores Jugadas</h3>
                    <label class="toggle-switch-small">
                        <input type="checkbox" id="toggle-best-moves" checked onchange="toggleBestMoves(this.checked)">
                        <span class="slider-small"></span>
                    </label>
                </div>
                <div id="best-moves-list" class="moves-list">
                    <div class="move-item placeholder">Calculando l√≠neas...</div>
                </div>
            </div>


            <div class="panel-tabs">
                <button class="tab-btn active" onclick="switchSideTab('analysis')">LOGS</button>
                <button class="tab-btn" onclick="switchSideTab('chat')">CHAT</button>
                <button class="tab-btn" onclick="switchSideTab('history')">MOVIMIENTOS</button>
            </div>

            <div id="tab-analysis" class="tab-content active">
                <div id="coach-txt" style="padding: 15px; min-height: 100px;">
                    <div style="font-size:0.75rem; color:var(--text-muted); text-align:center; padding:20px;">
                        Posici√≥n inicial. Realiza un movimiento para ver el an√°lisis del Maestro.
                    </div>
                </div>
            </div>

            <div id="tab-history" class="tab-content">
                <div id="move-history-list" style="padding: 15px;">
                    <!-- Moves will appear here -->
                </div>
            </div>

            <div id="tab-chat" class="tab-content">
                <div class="chat-area" id="chat-msgs">
                    <div class="chat-empty">Con√©ctate para empezar a chatear...</div>
                </div>
                <div class="chat-input-row" style="padding: 15px; border-top: 1px solid var(--border);">
                    <input type="text" id="chat-input" placeholder="Escribe un mensaje..."
                        style="background: var(--bg-main); border: 1px solid var(--border); border-radius: 8px; color: #fff; padding: 10px; flex: 1;">
                    <button id="btn-chat-send"
                        style="background: var(--primary); color: #fff; border: none; padding: 10px 15px; border-radius: 8px; margin-left:10px; cursor:pointer;">‚û§</button>
                </div>
            </div>
        </aside>
    </div>

    <!-- MODALES AUTH -->
    <div class="modal-overlay" id="auth-modal">
        <div class="modal-card">
            <div class="auth-tabs">
                <button class="auth-tab-btn active" onclick="switchAuthMode('login')">INICIAR SESI√ìN</button>
                <button class="auth-tab-btn" onclick="switchAuthMode('register')">REGISTRARSE</button>
            </div>

            <div id="auth-form-content">
                <div class="input-group">
                    <label>USUARIO</label>
                    <div class="input-container">
                        <input type="text" id="auth-user" placeholder="Tu nombre de usuario">
                    </div>
                </div>

                <div class="input-group" id="group-email" style="display:none;">
                    <label>EMAIL</label>
                    <div class="input-container">
                        <input type="email" id="auth-email" placeholder="ejemplo@email.com">
                    </div>
                </div>

                <div class="input-group">
                    <label>CONTRASE√ëA</label>
                    <div class="input-container">
                        <input type="password" id="auth-pass" placeholder="******">
                        <span class="password-toggle" onclick="togglePasswordVisibility('auth-pass')">üëÅÔ∏è</span>
                    </div>
                </div>

                <div class="remember-me-container" id="remember-me-row">
                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                        <input type="checkbox" id="auth-remember">
                        Recordarme
                    </label>
                </div>
            </div>

            <button class="btn-primary-auth" id="btn-auth-submit">ENTRAR</button>
            <button class="btn-secondary" onclick="$('#auth-modal').fadeOut()">CANCELAR</button>
        </div>
    </div>

    <script src="client.js?v=2"></script>
</body>

</html>